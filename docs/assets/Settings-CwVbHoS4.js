import{j as e,r as s,C as g,u as v,i as _,f as k,t as p,c as j}from"./index-rggvI3It.js";function N({label:c,Component:a}){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"settings-item-wrapper",children:[e.jsx("label",{className:"settings-item-name f-nunito",children:c}),e.jsx("div",{className:"settings-item-action-component",children:a})]})})}const W="_uemail-wrapper_16smm_3",C="_uemail-text_16smm_11",I="_options-wrapper_16smm_19",P="_logout-button_16smm_32",d={uemailWrapper:W,uemailText:C,optionsWrapper:I,logoutButton:P},E="_frame-wrapper_1qxs2_3",F="_close-button-wrapper_1qxs2_23",B="_close-button_1qxs2_23",T="_menu-items-wrapper_1qxs2_37",h={frameWrapper:E,closeButtonWrapper:F,closeButton:B,menuItemsWrapper:T};function w({children:c,showPopup:a,setShowPopup:t}){let n=s.useRef(null);return s.useEffect(()=>{n.current&&n.current.focus(),console.log("focussed run!")},[a]),e.jsx(e.Fragment,{children:a&&e.jsxs("div",{className:h.frameWrapper,ref:n,tabIndex:"0",autoFocus:!0,onBlur:()=>{t(!1),console.log("#16",a)},children:[e.jsx("div",{className:h.closeButtonWrapper,children:e.jsx("button",{className:h.closeButton,onClick:()=>t(!1),children:"X"})}),e.jsx("div",{className:h.menuItemsWrapper,children:c})]})})}function y(){const{profileData:c,setProfileData:a}=s.useContext(g),t=v(),[n,m]=s.useState(!1),{SERVER_IP:r}=s.useContext(g);async function u(){(await k.get(r+"/auth/logout",{withCredentials:!0})).data.code&&(localStorage.setItem("isLoggedIn",!1),localStorage.setItem("uemail",null),console.log("LSlogLO::",localStorage.getItem("isLoggedIn"),localStorage.getItem("uemail")),t("/sh-chat-fe/login"))}return s.useEffect(()=>{_(r,a)},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:d.uemailWrapper,children:[e.jsx("label",{className:d.uemailText,children:c?.uemail}),e.jsxs("button",{className:d.optionsWrapper,onClick:()=>{m(!0),console.log("#15",n)},children:[e.jsx("div",{className:"options-dot"}),e.jsx("div",{className:"options-dot"}),e.jsx("div",{className:"options-dot"})]}),e.jsx(w,{showPopup:n,setShowPopup:m,children:e.jsx("div",{className:d.logoutButton,onClick:()=>u(),children:"Log out"})})]})})}const R="_theme-wrapper_15zwm_3",$="_theme-wrapper-mods-for-frame_15zwm_11",z="_theme-name_15zwm_16",M="_theme-prev_15zwm_24",q="_theme-prev-text_15zwm_39",o={themeWrapper:R,themeWrapperModsForFrame:$,themeName:z,themePrev:M,themePrevText:q};function L(){const[c,a]=s.useState(p()),t=p(void 0,!0),[n,m]=s.useState(!1);return e.jsxs("div",{className:o.themeWrapper,children:[e.jsx("div",{className:`${o.themeName} f-nunito`,children:t.get(p()).name}),e.jsx("button",{className:o.themePrev,onClick:()=>m(!0),children:e.jsx("span",{className:`${o.themePrevText} f-nunito`,children:"Sh-chat"})}),e.jsx(w,{showPopup:n,setShowPopup:m,children:[...t].map(r=>e.jsxs("div",{className:`${o.themeWrapper} ${o.themeWrapperModsForFrame}`,onClick:()=>p(r[0]),children:[e.jsx("div",{className:`${o.themeName} f-nunito`,children:r[1].name}),e.jsx("div",{className:o.themePrev,style:{background:r[1].bg},children:e.jsx("span",{className:`${o.themePrevText} f-nunito`,style:{color:r[1].text},children:"Sh-chat"})})]},r[0]))})]})}function H(){const c=v(),{SERVER_IP:a,profileData:t,setProfileData:n,makeContactsMap:m,contactsMap:r}=s.useContext(g),[u,f]=s.useState(!1),[D,U]=s.useState("");let l=s.useRef(null);async function b(){try{console.log("i work@21");const i=await k.post(`${a}/profile/nickname`,{nickname:l.current.value},{withCredentials:!0});i.data.code?(await j.contacts.where("uemail").equals(t.uemail).modify({nickname:i.data.nickname}),await _(a,n),await m(),console.log("big21::",i.data,r.get("man@sh.sh"),"cm:",r)):console.error("nickname update failed",i.data.codeMsg);const x=await j.contacts.where("uemail").equals("man@sh.sh").first();console.log("see:::",x)}catch(i){console.error("debug::handleSaveNickname: nickname update failed",i)}}function S(){l.current&&(l.current.size=l.current.value.length>0?l.current.value.length:1)}return s.useEffect(()=>{S(),l.current&&l.current.focus()},[t,u]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"settings-page-wrapper",children:[e.jsxs("div",{className:"profile-pic-wrapper",children:[e.jsx("button",{className:"settings-back-button",onClick:()=>{c("/sh-chat-fe/")},children:"â†©"}),e.jsx("div",{className:"profile-pic profile-pic-img f-fbm",children:t?.nickname.slice(0,1).toUpperCase()}),u?e.jsxs("div",{className:"profile-name-wrapper",children:[e.jsx("input",{className:"profile-name-input f-m",ref:l,value:t.nickname,size:"",onInput:i=>{n(x=>({...x,nickname:i.target.value}))}}),e.jsx("button",{className:"nickname-button nickname-save",onClick:()=>{b(),f(!1)},children:"âœ“"})]}):e.jsxs("div",{className:"profile-name-wrapper",children:[e.jsx("p",{className:"profile-name-label f-m",children:t?.nickname}),e.jsx("button",{className:"nickname-button nickname-edit ",onClick:()=>f(!0),children:"ðŸ–‰"})]})]}),e.jsxs("div",{className:"settings-items-area-wrapper",children:[e.jsx(N,{label:"Email",Component:e.jsx(y,{})}),e.jsx(N,{label:"Theme",Component:e.jsx(L,{})})]})]})})}export{H as default};
