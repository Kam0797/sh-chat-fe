import{r as n,C,u as f,c as w,j as s,g as b}from"./index-Csk11ev_.js";function E({chat:e,showThese:l}){const{setSelectedChat:p,contactsMap:h,selectedChat:x,unreadMap:c}=n.useContext(C),j=f(),[d,u]=n.useState(null),[t,o]=n.useState(null),[i,m]=n.useState();async function v(a,r){const g=(await a?.messages.where("chatId").equals(r).sortBy("timestamp")).at(-1)??"",k=(await a?.chats.where("chatId").equals(r).first()).members.length>2;u(g),o(k)}function S(a){switch(console.log("i work",a),a||console.warn("arg `list` invalid"),a){case"all":m(!0),console.log("SEL:all",!0);break;case"chats":m(!t),console.log("SEL:NG",!t);break;case"groups":m(t),console.log("SEL:G",t);break}}function I(a){if(!a)return"";const r=new Date(a),N=r.getHours().toString().padStart(2,"0"),g=r.getMinutes().toString().padStart(2,"0");return`${N}:${g}`}return n.useEffect(()=>{(async()=>v(w,e.chatId))()},[c,e.chatId]),n.useEffect(()=>{t!==null&&l&&(S(l),console.info("inf1::",i,l))},[l,t]),(d||t)&&i&&s.jsxs("button",{className:"chat-list-item",onClick:()=>{p(e.chatId),j(`/sh-chat-fe/chat?chatId=${e.chatId}`)},children:[s.jsx("div",{className:"profile-pic f-jbm",children:b(e,h)?.slice(0,2)}),s.jsxs("div",{className:"details-area",children:[s.jsxs("div",{className:"name-time",children:[s.jsx("div",{className:"name",children:s.jsx("span",{className:"add-ellipsis f-nunito",children:b(e,h)})}),s.jsx("div",{className:"time f-jbm",children:I(d?.timestamp)})]}),s.jsxs("div",{className:"message-unreadcount",children:[s.jsx("div",{className:"last-message",children:s.jsx("span",{className:"add-ellipsis f-m",children:d?.content})}),c?.get(e.chatId)&&s.jsx("div",{className:"unread-count",children:c?.get(e.chatId)<100?c?.get(e.chatId):"99+"})]})]})]})}function G(){const{SERVER_IP:e,selectedChat:l,setChatData:p,socket:h,chatList:x,setChatList:c,outboundMessageStream:j,messageStream:d}=n.useContext(C),u=f(),[t,o]=n.useState(localStorage.getItem("visibleChats")||"all");return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"chat-list-wrapper",children:[s.jsx("button",{className:"new-chat",onClick:()=>{u("/sh-chat-fe/contacts")},children:"+"}),s.jsxs("div",{className:"options-bar",children:[s.jsxs("div",{className:"sort-area",children:[s.jsx("button",{className:`sort-button all ${t==="all"?"sort-button-selected":null}`,onClick:()=>{o("all"),localStorage.setItem("visibleChats","all")},children:"All"}),s.jsx("button",{className:`sort-button chats ${t==="chats"?"sort-button-selected":null}`,onClick:()=>{o("chats"),localStorage.setItem("visibleChats","chats")},children:"Chats"}),s.jsx("button",{className:`sort-button groups ${t==="groups"?"sort-button-selected":null}`,onClick:()=>{o("groups"),localStorage.setItem("visibleChats","groups")},children:"Groups"})]}),s.jsxs("div",{className:"options-area",children:[s.jsx("button",{className:"search-button"}),s.jsxs("button",{className:"app-options",onClick:()=>{u("/sh-chat-fe/settings")},children:[s.jsx("div",{className:"options-dot"}),s.jsx("div",{className:"options-dot"}),s.jsx("div",{className:"options-dot"})]})]})]}),s.jsx("div",{className:"sort-list-wrapper",children:s.jsx("div",{className:"sort-list",children:x?.map(i=>s.jsx(E,{chat:i,showThese:t},i.chatId))})})]})})}export{G as default};
