import{r as a,C as b,u as v,g as C,c as E,j as s}from"./index-CGJ8KRv5.js";function L({chat:t,showThese:c}){const{setSelectedChat:g,contactsMap:d,selectedChat:x,unreadMap:l}=a.useContext(b),j=v(),[u,h]=a.useState(null),[e,i]=a.useState(null),[o,m]=a.useState(),[N,I]=a.useState(C(t,d));async function S(n,r){const p=(await n?.messages.where("chatId").equals(r).sortBy("timestamp")).at(-1)??"",M=(await n?.chats.where("chatId").equals(r).first()).members.length>2;h(p),i(M)}function k(n){switch(console.log("i work",n),n||console.warn("arg `list` invalid"),n){case"all":m(!0);break;case"chats":m(!e);break;case"groups":m(e);break}}function w(n){if(!n)return"";const r=new Date(n),f=r.getHours().toString().padStart(2,"0"),p=r.getMinutes().toString().padStart(2,"0");return`${f}:${p}`}return a.useEffect(()=>{(async()=>S(E,t.chatId))()},[l,t.chatId]),a.useEffect(()=>{e!==null&&c&&(k(c),console.info("inf1::",o,c))},[c,e]),a.useEffect(()=>{I(C(t,d))},[t,d]),(u||e)&&o&&s.jsxs("button",{className:"chat-list-item",onClick:()=>{g(t.chatId),j(`/sh-chat-fe/chat?chatId=${t.chatId}`)},children:[s.jsx("div",{className:"profile-pic f-jbm",children:N?.slice(0,2)}),s.jsxs("div",{className:"details-area",children:[s.jsxs("div",{className:"name-time",children:[s.jsx("div",{className:"name",children:s.jsx("span",{className:"add-ellipsis f-nunito",children:N})}),s.jsx("div",{className:"time f-jbm",children:w(u?.timestamp)})]}),s.jsxs("div",{className:"lastmessage-unreadcount",children:[s.jsx("div",{className:"last-message",children:s.jsx("span",{className:"add-ellipsis f-m",children:u?.content})}),l?.get(t.chatId)&&s.jsx("div",{className:"unread-count",children:l?.get(t.chatId)<100?l?.get(t.chatId):"99+"})]})]})]})}function G(){const{SERVER_IP:t,selectedChat:c,setChatData:g,socket:d,chatList:x,setChatList:l,outboundMessageStream:j,messageStream:u}=a.useContext(b),h=v(),[e,i]=a.useState(localStorage.getItem("visibleChats")||"all");return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"chat-list-wrapper",children:[s.jsx("button",{className:"new-chat",onClick:()=>{h("/sh-chat-fe/contacts")},children:"+"}),s.jsxs("div",{className:"options-bar",children:[s.jsxs("div",{className:"sort-area",children:[s.jsx("button",{className:`sort-button all ${e==="all"?"sort-button-selected":null}`,onClick:()=>{i("all"),localStorage.setItem("visibleChats","all")},children:"All"}),s.jsx("button",{className:`sort-button chats ${e==="chats"?"sort-button-selected":null}`,onClick:()=>{i("chats"),localStorage.setItem("visibleChats","chats")},children:"Chats"}),s.jsx("button",{className:`sort-button groups ${e==="groups"?"sort-button-selected":null}`,onClick:()=>{i("groups"),localStorage.setItem("visibleChats","groups")},children:"Groups"})]}),s.jsxs("div",{className:"options-area",children:[s.jsx("button",{className:"search-button"}),s.jsxs("button",{className:"app-options",onClick:()=>{h("/sh-chat-fe/settings")},children:[s.jsx("div",{className:"options-dot"}),s.jsx("div",{className:"options-dot"}),s.jsx("div",{className:"options-dot"})]})]})]}),s.jsx("div",{className:"sort-list-wrapper",children:s.jsx("div",{className:"sort-list",children:x?.map(o=>s.jsx(L,{chat:o,showThese:e},o.chatId))})})]})})}export{G as default};
