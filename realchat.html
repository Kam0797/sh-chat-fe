<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <div id='chat-room-mes'></div>
    <button onclick={logout()}>Logout</button> 
    <div id='chat-list'></div>
    
    <hr/>
    Type members:<input id='create-chat-text-box' /><button id='create-chat-btn'>New chat!</button>
    <hr />

    select chat: <select id='select-chat'></select><br />
    <div id='message-area'></div>
    <input type='text' id='msg-box' required ><button id='msg-send-btn'>Send</button>
  </body>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+" crossorigin="anonymous"></script>

  <script>
    const SERVER_IP =
    window.location.hostname === 'localhost'
    ? 'http://localhost:3000'
    : 'https://sh-chat.onrender.com';

    const msgArea = document.getElementById('chat-room-mes');
    console.log('rc: loaded')
    axios.get(SERVER_IP+'/chat-room',{
      withCredentials: true
    }).then(res => {if(!res.data.code) {console.log('rc log'); window.location.href='/index.html'}
      else {msgArea.textContent = res.data.msg;}})
      .catch(err => {console.log('ff',err); window.location.href='/index.html'})


    function logout() {
      if(window.confirm('do you want to logout of sh-chat?')) {
        axios.get(SERVER_IP+"/auth/logout",{withCredentials: true})
          .then(res=> {msgArea.textContent = res.data.codeMsg;
          window.location.href='/index.html'})
          .catch(err => {console.error(err); msgArea.textContent = 'logout failed';})
      }
    }

    
  </script>
  <script type="module" src="./chatListRAM.js"></script>
</html>

